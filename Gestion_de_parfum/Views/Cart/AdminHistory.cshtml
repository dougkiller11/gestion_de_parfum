@model List<Gestion_de_parfum.Models.Commande>
@{
    ViewData["Title"] = "Historique des commandes (Admin)";
    Layout = null;
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Essence Luxe</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family:'Inter',sans-serif; background:#050505; color:white; margin:0; }
        .wrap { max-width: 1200px; margin:0 auto; padding:40px 20px 60px; }
        h1 { color:#d4af37; margin:0 0 18px; font-size:30px; }
        .card { background: linear-gradient(180deg, rgba(12,12,12,0.92) 0%, rgba(6,6,6,0.95) 100%); border:1px solid rgba(212,175,55,0.22); border-radius:16px; padding:22px; box-shadow:0 18px 42px rgba(0,0,0,0.38); }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th, td { padding:10px; border-bottom:1px solid rgba(212,175,55,0.15); text-align:left; font-size:13px; }
        th { color:#d4af37; font-size:14px; }
        .status { padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px; display:inline-block; }
        .status.pending { background:rgba(234,179,8,0.14); color:#eab308; }
        .status.done { background:rgba(74,222,128,0.14); color:#4ade80; }
        .muted { color:rgba(255,255,255,0.7); font-size:13px; }
        .inline-form { display:flex; gap:6px; align-items:center; margin:0; }
        .header-actions { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
        .back-btn { display:inline-block; padding:8px 12px; border-radius:10px; border:1px solid rgba(212,175,55,0.25); background:rgba(255,255,255,0.06); color:white; text-decoration:none; font-weight:700; }
        .back-btn:hover { background:rgba(255,255,255,0.12); }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="header-actions">
            <h1>Historique des commandes (Admin)</h1>
            <a class="back-btn" href="@Url.Action("Dashboard","AdminProducts")">Retour dashboard</a>
        </div>
        <div class="card">
            @if (Model != null && Model.Any())
            {
                <table>
                    <thead>
                        <tr>
                            <th>Commande</th>
                            <th>Date</th>
                            <th>Client</th>
                            <th>Statut</th>
                            <th>Total</th>
                            <th>Détails</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var cmd in Model)
                        {
                            <tr>
                                <td>CMD-@cmd.Id.ToString("000000")</td>
                                <td>@cmd.Date.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@cmd.Client?.Utilisateur?.Nom</td>
                                <td>
                                    <span class="status @(cmd.Statut == "Livrée" ? "done" : "pending")">
                                        @(!string.IsNullOrEmpty(cmd.Statut) ? cmd.Statut : "En attente")
                                    </span>
                                </td>
                                <td>@cmd.Total.ToString("F2") €</td>
                                <td>
                                    <div class="muted">
                                        @foreach (var l in cmd.LigneCommandes)
                                        {
                                            <div>@l.Parfum?.Nom x@l.Quantite — @(l.SousTotal.ToString("F2")) €</div>
                                        }
                                    </div>
                                </td>
                                <td>
                                    <form class="inline-form" method="post" action="@Url.Action("UpdateStatus", "Cart")">
                                        <input type="hidden" name="id" value="@cmd.Id" />
                                        <input type="hidden" name="returnUrl" value="@Context.Request.Path" />
                                        <select name="statut" required style="padding:6px; border-radius:8px; border:1px solid rgba(212,175,55,0.25); background:rgba(255,255,255,0.04); color:white;">
                                            <option value="En attente" @(cmd.Statut == "En attente" ? "selected" : "")>En attente</option>
                                            <option value="Livrée" @(cmd.Statut == "Livrée" ? "selected" : "")>Livrée</option>
                                        </select>
                                        <button type="submit" class="btn btn-secondary" style="padding:6px 10px; cursor:pointer;">OK</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="muted">Aucune commande enregistrée.</div>
            }
        </div>
    </div>
</body>
</html>

